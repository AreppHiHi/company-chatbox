<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexora Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="chat-wrapper">

    <!-- Header -->
    <div class="chat-header">
        <div class="header-info">
            <div class="bot-avatar">ğŸ¤–</div>
            <div class="header-text">
                <h3>Nexora Assistant</h3>
                <span class="status">â— Online</span>
            </div>
        </div>
        <button class="reset-btn" onclick="resetChat()">ğŸ—‘ï¸ Clear</button>
    </div>

    <!-- Messages Area -->
    <div class="chat-messages" id="chatMessages">
        <div class="message bot-message">
            <div class="bot-icon">ğŸ¤–</div>
            <div class="message-bubble">
                ğŸ‘‹ Hello! I'm <strong>Nexora Assistant</strong>.<br><br>
                I can help with:<br>
                ğŸ¢ Company info & mission<br>
                ğŸ“¦ Products & services<br>
                ğŸ‘¥ Employee information<br>
                ğŸ“ Contact & support<br><br>
                How can I help you today?
            </div>
        </div>
    </div>

    <!-- Suggested Questions -->
    <div class="suggestions" id="suggestions">
        <button onclick="askSuggestion('Who is the CEO?')">Who is the CEO?</button>
        <button onclick="askSuggestion('What is the company mission?')">Company mission?</button>
        <button onclick="askSuggestion('How do I contact support?')">Contact support?</button>
    </div>

    <!-- Input Area -->
    <div class="chat-input-area">
        <input
            type="text"
            id="userInput"
            placeholder="Type your message..."
            onkeypress="handleKeyPress(event)"
        />
        <button onclick="sendMessage()" id="sendBtn">â¤</button>
    </div>

</div>

<script>
    async function sendMessage() {
        const input = document.getElementById("userInput");
        const message = input.value.trim();
        if (!message) return;

        document.getElementById("suggestions").style.display = "none";

        appendMessage(message, "user");
        input.value = "";
        showTyping();

        try {
            const response = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: message })
            });

            const data = await response.json();
            removeTyping();
            appendMessage(data.reply, "bot");

        } catch (error) {
            removeTyping();
            appendMessage("Sorry, something went wrong. Please try again.", "bot");
        }
    }

    function appendMessage(text, sender) {
        const chatMessages = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.classList.add("message", sender === "user" ? "user-message" : "bot-message");

        // Convert markdown to readable format
        let formattedText = text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')  // **bold**
            .replace(/\*(.*?)\*/g, '$1')                        // *italic* remove stars
            .replace(/\n/g, '<br>');                            // new lines

        if (sender === "bot") {
            messageDiv.innerHTML = `
                <div class="bot-icon">ğŸ¤–</div>
                <div class="message-bubble">${formattedText}</div>`;
        } else {
            messageDiv.innerHTML = `<div class="message-bubble">${formattedText}</div>`;
        }

        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function showTyping() {
        const chatMessages = document.getElementById("chatMessages");
        const typingDiv = document.createElement("div");
        typingDiv.classList.add("message", "bot-message");
        typingDiv.id = "typingIndicator";
        typingDiv.innerHTML = `
            <div class="bot-icon">ğŸ¤–</div>
            <div class="message-bubble typing">
                <span></span><span></span><span></span>
            </div>`;
        chatMessages.appendChild(typingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function removeTyping() {
        const typing = document.getElementById("typingIndicator");
        if (typing) typing.remove();
    }

    function handleKeyPress(event) {
        if (event.key === "Enter") sendMessage();
    }

    function askSuggestion(question) {
        document.getElementById("userInput").value = question;
        sendMessage();
    }

    async function resetChat() {
        await fetch("/reset", { method: "POST" });
        const chatMessages = document.getElementById("chatMessages");
        chatMessages.innerHTML = `
            <div class="message bot-message">
                <div class="bot-icon">ğŸ¤–</div>
                <div class="message-bubble">
                    Chat cleared! ğŸ‘‹ How can I help you today?
                </div>
            </div>`;
        document.getElementById("suggestions").style.display = "flex";
    }
</script>

</body>
</html>